
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.10">
    
    
      
        <title>Metrics - AICOE-CD</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.d6be258b.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
          
          
          <meta name="theme-color" content="#ef5552">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Work+Sans:300,400,400i,700%7C&display=fallback">
        <style>:root{--md-text-font:"Work Sans";--md-code-font:""}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="red" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#important-metrics" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="AICOE-CD" class="md-header__button md-logo" aria-label="AICOE-CD" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AICOE-CD
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Metrics
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="AICOE-CD" class="md-nav__button md-logo" aria-label="AICOE-CD" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    AICOE-CD
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Guides" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../get_argocd_to_manage_your_app/" class="md-nav__link">
        Get ArgoCD to manage your app
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../create_argocd_application_manifest/" class="md-nav__link">
        Create ArgoCD application manifest
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../give_argocd_access_to_your_project/" class="md-nav__link">
        Give ArgoCD access to your project
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../manage_your_app_secrets/" class="md-nav__link">
        Manage Your App Secrets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../inclusions_explained/" class="md-nav__link">
        Inclusions Explained
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Admin
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Admin" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Admin
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../admin/add_namespace_to_cluster/" class="md-nav__link">
        Add namespace to cluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../admin/add_new_cluster_spec/" class="md-nav__link">
        Adding a new cluster spec
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../admin/update_gpg_key/" class="md-nav__link">
        Update gpg key
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../argocd_project_permissions/" class="md-nav__link">
        Permissions
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Development
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Development" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Development
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../setup_argocd_dev_environment/" class="md-nav__link">
        Configuring Environment
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../versions/" class="md-nav__link">
        Versions
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Metrics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Metrics
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#service-level-indicators" class="md-nav__link">
    Service Level Indicators
  </a>
  
    <nav class="md-nav" aria-label="Service Level Indicators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sli-descriptions" class="md-nav__link">
    SLI Descriptions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-metrics" class="md-nav__link">
    Usage Metrics
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#service-level-indicators-for-app-owners" class="md-nav__link">
    Service Level Indicators for App Owners
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#possible-service-level-indicators" class="md-nav__link">
    Possible Service Level Indicators
  </a>
  
    <nav class="md-nav" aria-label="Possible Service Level Indicators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#metric-descriptions" class="md-nav__link">
    Metric Descriptions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#service-level-indicators" class="md-nav__link">
    Service Level Indicators
  </a>
  
    <nav class="md-nav" aria-label="Service Level Indicators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sli-descriptions" class="md-nav__link">
    SLI Descriptions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-metrics" class="md-nav__link">
    Usage Metrics
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#service-level-indicators-for-app-owners" class="md-nav__link">
    Service Level Indicators for App Owners
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#possible-service-level-indicators" class="md-nav__link">
    Possible Service Level Indicators
  </a>
  
    <nav class="md-nav" aria-label="Possible Service Level Indicators">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#metric-descriptions" class="md-nav__link">
    Metric Descriptions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h1 id="important-metrics">Important Metrics</h1>
<p>We are tracking a number of metrics at our operations dashboard. What follows are the distinct categories of metrics</p>
<h2 id="service-level-indicators">Service Level Indicators</h2>
<p>SLIs are carefully defined quantitative measures of some aspect of the level of service that is provided. You can find more information on SLIs in the <a href="https://landing.google.com/sre/sre-book/chapters/service-level-objectives">Site Reliability Engineering Book</a>.</p>
<table>
<thead>
<tr>
<th>SLI</th>
<th>Query</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td>Availability</td>
<td>min(up{job="ArgoCD Metrics"})</td>
<td>Done</td>
</tr>
<tr>
<td>Reconciliation Performance</td>
<td>sum(increase(argocd_app_reconcile_bucket{dest_server=\~"$Server", job="ArgoCD Metrics"}[10m])) by (le)</td>
<td>Needs Update to use Histogram</td>
</tr>
<tr>
<td>Length of Work Queue</td>
<td>increase(workqueue_unfinished_work_seconds{}[10m])</td>
<td>Done</td>
</tr>
</tbody>
</table>
<h3 id="sli-descriptions">SLI Descriptions</h3>
<ol>
<li><strong>Availability:</strong> This tells us whether important ArgoCD pods are up.</li>
<li><strong>Reconciliation Performance:</strong> For ArgoCD, Reconciliation refers to making the state of the application match what is stored in git. This is usually done by managing Kubernetes objects. This SLI lets us see how much time our reconciliations are taking, and whether the system is performing in a degraded state/ needs to be scaled up.</li>
<li><strong>Length of Work Queue:</strong> This tells how many seconds of work are in progress but have not been observed by work_duration. Large values usually indicate stuck threads.</li>
</ol>
<h2 id="usage-metrics">Usage Metrics</h2>
<p>These metrics are being used to track usage of the ArgoCD instance</p>
<table>
<thead>
<tr>
<th>Usage Metric</th>
<th>Query</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td>Number of Managed Servers</td>
<td>count(count by (dest_server) (argocd_app_info{project=\~"$Project"}))</td>
<td>Done</td>
</tr>
<tr>
<td>Number of Managed Apps</td>
<td>count((argocd_app_info{project=\~"$Project"}))</td>
<td>Done</td>
</tr>
<tr>
<td>Number of Source Repos</td>
<td>count(count by (repo) (argocd_app_info{project=\~"$Project"}))</td>
<td>Done</td>
</tr>
<tr>
<td>Rate of Change</td>
<td>To Be Implemented</td>
<td>Not Done</td>
</tr>
</tbody>
</table>
<h2 id="service-level-indicators-for-app-owners">Service Level Indicators for App Owners</h2>
<p>These metrics are possible SLIs for the App Owners</p>
<table>
<thead>
<tr>
<th>SLI</th>
<th>Query</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td>App Sync Failures</td>
<td>ceil(increase(argocd_app_sync_total{dest_server=\~"\$Server", project=\~"$Project", phase=\~"Error|Failed"}[10m]))</td>
<td>Done</td>
</tr>
</tbody>
</table>
<h2 id="possible-service-level-indicators">Possible Service Level Indicators</h2>
<p>These metrics are interesting to look at but their usefulness has not yet been determined.</p>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Query</th>
<th>Possible Usage</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td>Percentage of Apps in Sync</td>
<td>sum(argocd_app_info{sync_status="Synced", dest_server=\~"\$Server", dest_namespace=\~"\$Namespace", project=\~"\$Project"})/sum(argocd_app_info{dest_server=\~"\$Server", dest_namespace=\~"\$Namespace", project=\~"\$Project"})</td>
<td>App Owner SLI</td>
<td>Done</td>
</tr>
<tr>
<td>Cumulative GRPC Success Rate</td>
<td>sum(grpc_server_handled_total{grpc_code="OK",job="ArgoCD Metrics"})/sum(grpc_server_handled_total{job="ArgoCD Metrics"})</td>
<td>SRE SLI</td>
<td>Done</td>
</tr>
<tr>
<td>Application Time Spent out of Sync</td>
<td>To be Implemented</td>
<td>App Owner SLI</td>
<td>Not Done</td>
</tr>
<tr>
<td>App Reconciliation Work Duration</td>
<td>sum(increase(workqueue_work_duration_seconds_bucket{name="app_reconciliation_queue"}[10m])) by (le)</td>
<td>SRE SLI</td>
<td>Update to use Histogram</td>
</tr>
<tr>
<td>App Operation Processing Work Duration</td>
<td>sum(increase(workqueue_work_duration_seconds_bucket{name="app_operation_processing_queue"}[10m])) be (le)</td>
<td>SRE SLI</td>
<td>Update to use Histogram</td>
</tr>
</tbody>
</table>
<h3 id="metric-descriptions">Metric Descriptions</h3>
<ol>
<li><strong>Percentage of Apps in Sync:</strong> Having a large percentage of apps be out of sync for a long duration indicates that there are some issues going on. Since the issues can be caused by both app-owners and the SREs it doesn't make sense to have this as an SRE SLI.</li>
<li><strong>Cumulative GRPC Success Rate:</strong> Seeing a large drop in the success rate could indicate issues with the underlying system.</li>
<li><strong>Application Time Spent out of Sync:</strong> Similar to <em>1</em>, this can have multiple causes so it is difficult to define an SRE SLI based on this.</li>
<li><strong>App Reconciliation Work Duration:</strong> This gives us a histogram of how much time (in seconds) it takes for ArgoCD to process items in the App Reconciliation queue.</li>
<li><strong>App Operation Processing Work Duration:</strong> This gives us a histogram of how much time (in seconds) it takes for ArgoCD to process items in the App Processing queue.</li>
</ol>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../versions/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Versions" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Versions
            </div>
          </div>
        </a>
      
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.092fa1f6.min.js"}</script>
    
    
      <script src="../assets/javascripts/bundle.e3b2bf44.min.js"></script>
      
    
  </body>
</html>